# Talos

Each machine in the homelab cluster runs [Talos Linux](https://www.talos.dev/) - a minimal,
kubernetes-focused Linux distribution.

This folder contains talos related configuration and base asset settings.

## Commands

Commands are run via talosctl:

```shell
# if a specifc node(s) needs to be targeted
talosctl -n "<node-a>.bulia,<node-2>.bulia" <...command>
# otherwise
talosctl <...command>
```

## Configuration

Base configuration directly generated by `talosctl gen config` exist as `config`, `controlplane.yaml` and `worker.yaml` files respectively.
These contain secrets and are excluded from the repository _but need to exist_ to be able to interact with the cluster via talosctl.
Meanwhile, each host's unique configuration overlays _do_ exist within the repo - at `<host>.yaml`.

Assuming talosctl is configured to point to the cluster's talosconfig file, configuration is applied via the following command:

```shell
NODE=<node> ROLE=<role> talosctl -n "${NODE}.bulia" apply-config --file "${ROLE}.yaml" --config-patch @"${NODE}.yaml"
```

## Base Assets

The cluster nodes run a custom talos image with custom base assets.

### Building system extensions

Navigate to the [./image](./image) folder and run the following command.

```shell
docker buildx build --platform linux/arm64,linux/amd64 -f ./Pkgfile --target <extension> .
```

If you want to inspect the resulting extension, run the following command:

```shell
docker buildx build --platform linux/arm64,linux/amd64 -f ./Pkgfile --target <extension> --output=type=local,dest=$(DEST)
### Building custom image

