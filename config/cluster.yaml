endpoint: cluster.bulia.dev
hardware:
  tc:
    disks:
      SYSTEM:
        device: /dev/nvme0n1
      EPHEMERAL:
        device: /dev/nvme0n1
        size: 200GiB
      piraeus:
        device: /dev/nvme0n1
        size: 1600GiB
    image: factory.talos.dev/metal-installer/e048aaf4461ff9f9576c9a42f760f2fef566559bd4933f322853ac291e46f238:v1.11.3
  rpi4:
    disks:
      SYSTEM:
        device: /dev/mmcblk0
      EPHEMERAL:
        device: /dev/sda
        size: 200GiB
      piraeus:
        device: /dev/sda
        size: 700GiB
    image: factory.talos.dev/metal-installer/cb923a5c4db88e5d008f7c9551da8172f835dcedd18f06d397e86dbaa1a39513:v1.11.3
kubernetes: 1.33.2
name: homelab

baseTalosConfig:
  machine:
    features:
      hostDNS:
        # TODO: update cilium network policies to allow DNS requests to be made to 169.254.116.108 - then remove this patch
        # SEE: https://www.talos.dev/v1.10/talos-guides/network/host-dns/
        forwardKubeDNSToHost: false
    kernel:
      modules:
        # configure drbd kernel modules (piraeus)
        - name: dm_mod
        - name: dm_thin_pool
        - name: drbd
          parameters:
            - usermode_helper=disabled
        - name: drbd_transport_tcp
    kubelet:
      extraMounts:
        # configure r/w mounts (piraeus)
        - destination: /var/local
          source: /var/local
          type: bind
          options:
            - rbind
            - rshared
            - rw
  cluster:
    network:
      # disable cni (cilium)
      cni:
        name: none
    # disable kube-proxy (cilium)
    proxy:
      disabled: true
